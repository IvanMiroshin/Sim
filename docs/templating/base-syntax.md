# Базовый синтаксис

Все операторы шаблонизатора Sim располагаются в зарезервированном атрибуте элемента DOM — `data-sim`. Когда шаблонизатор встречает элемент с атрибутом `data-sim`, он выполняет попытку интерпретировать указанные в нем операторы и выполнить их для текущего элемента. Если шаблонизатор не может выполнить интерпретацию, то будет возвращена ошибка.

Наиболее часто возникающие ошибки:

* **Template Error indexation in line —** Ошибка возникает в случае, если после индексации шаблона в его составе остались не проиндексированные атрибуты data-sim. Самой вероятной причиной такой ошибки может быть некорректный HTML синтаксис
* **Method '…' is not found** — Ошибка возникает в случае попытки использовать не зарегистрированный оператор. Список стандартных операторов представлен ниже в документации.
* **Syntax error in data-sim** — Синтаксическая ошибка. Операторы или их отдельные части использованы некорректно для указанного элемента.
* **Macro with name '...' missing** — Ошибка возникает при попытке использовать не инициализированный макрос.
* **Template error indexation in line \(Incorrect JSON string\)** — Атрибут элемента DOM в который вы пытаетесь присвоить значение содержит не валидный JSON объект. В некоторых ситуациях, это может привести к нестабильной работе шаблонизатора.
* **Invalid cache path** — Причиной этой ошибки может быть два случая:
  * В метод setCachePath, был переда невалидный путь до папки хранения кеша.
  * В метод resetCache, был передан путь к несуществующей дирректории

## Ограничения синтаксиса

Для корректной работы, DOM элементы, в которых используются атрибуты шаблонизатора, должны отвечать следующим обязательным правилам:

{% hint style="warning" %}
Значения любых атрибутов необходимо заключать в кавычки, кроме атрибутов содержащих JSON.
{% endhint %}

{% hint style="warning" %}
Любой тег в котором используется синтаксис "Sim" должен быть закрыт либо ответным тегом, либо символом " /".
{% endhint %}

Данный пример вызовет ошибку — «Template Error indexation in line …»:

```markup
<meta name="description" data-sim="attr(‘content’, $data.desc);">
```

Эти примеры выполняться корректно:

```markup
<meta name="description" data-sim="attr(‘content’,$data.desc);" />
```

```markup
<meta name="description">
```

{% hint style="warning" %}
Правильная вложенность тегов должны соблюдаться.
{% endhint %}

{% hint style="warning" %}
Не допускается использование сокращенных атрибутов тегов.
{% endhint %}

Использование сокращенных атрибутов тегов, приведет к некорректной работе  
оператора `attributes/attr`.

Примеры правильного оформления сокращенных тегов:

| Сокращение | Требуемый формат использования |
| :--- | :--- |
| checked | checked="checked" |
| compact | compact="compact" |
| compact | disabled="disabled" |
| disabled | disabled="disabled" |
| ismap | ismap="ismap" |
| multiple | multiple="multiple" |
| nohref | nohref="nohref" |
| noresize | noresize="noresize" |
| noshade | noshade="noshade" |
| nowrap | nowrap="nowrap" |
| readonly | readonly="readonly" |
| selected | selected="selected" |

## Комментарии

В закомментированных областях логика шаблонизатора не выполняется. Закомментированные участки кода не будут доступны в скомпилированном шаблоне.

Пример использования комментария:

```markup
<!--#h1 data-sim="content('test')"> ... </h1#-->
```

## Переменные

Переменные шаблона начинаются со знака $доллара. Они могут состоять из цифр, букв и знака подчеркивания. Наименование переменных соответствует ключам переданного в шаблонизатор массива. Для доступа к атрибутам переменной \(элементам PHP-массива\) используется знак «.».

Обращение к элементу массива PHP:

```php
$myarray[element][sub-element]
```

Обращение к элементу массива в рамках синтаксиса Sim:

```text
$myarray.element.sub-element
```

**В шаблоне доступны следующие переменные:**

1. `$data` — содержит массив переданный в шаблон или в текущий блок шаблона; 
2. `$block` — содержит массивы данных переданные в отдельные блоки шаблона; 
3. `$root` — содержит все данные переданные в текущий шаблон. Реализует доступ к данным родительского блока или шаблона; 
4. `$template` — массив параметров шаблона: 1. `path` — путь к файлу с шаблоном. Может принимать значение **false**, если шаблон передан в виде исходника; 2. `cache` — **true**, если шаблон восстановлен из кеша, иначе **false**; _\*\*_ 3. `cache_file` — путь до кеш-файла шаблона; 4. `root_url` — путь для создания абсолютных ссылок внутри шаблон;
   1. `root_path` — путь до корневой директории с шаблонами; 
   2. `object` — объект шаблонизатора \(class Sim\); 
5. `$_server` — информация о сервере и среде исполнения. Содержит данные из глобальной PHP переменной $\_SERVER; 
6. `$_get` — переменные HTTP-запроса GET. Содержит данные из глобальной PHP переменной $\_GET; 
7. `$_post` — переменные HTTP-запроса POST. Содержит данные из глобальной PHP переменной $\_POST; 
8. `$_request` — переменные HTTP-запроса. Содержит данные из глобальной PHP переменной $\_REQUEST; 
9. `$_cookie` — переменные куки. Содержит данные из глобальной PHP переменной $\_COOKIE; 
10. `$_session` — переменные сессии. Содержит данные из глобальной PHP переменной $\_SESSION; 
11. `$_env` — переменные окружения. Содержит данные из глобальной PHP переменной $\_ENV.

## Назначение переменных из шаблона

Для назначения переменных из шаблона используется оператор «set»

```markup
set($myvar, 'Значение')
```

Если в шаблоне используется разделение на блоки, то такие переменные будут доступны только в в пределах блока в котором они были определены.

## Конкатенация строк

Для конкатенации строк используется специальный зарезервированный символ «+», который возвращает строку, представляющую собой соединение левого и правого аргумента.

```markup
<span data-sim="content('Значение - '+$data.myvar);"> … </span>
```

## Зарезервированные символы и экранирование

Некоторые символы в Sim имеют особые значения. Если вы поместите, например, символ «$» внутри строкового значения, то будет возвращена ошибка, так как парсер интерпретирует его, как значение переменной.

Так, к ошибке приведет следующая строка конструкция:

```markup
<span data-sim="content('Значение «$data.myvar» '+$data.myvar);"> 
    … 
</span>​
```

Чтобы такая ошибка не возникала, необходимо экранировать символ «$» и «.»:

```markup
<span data-sim="content('Значение «\$data\.myvar» '+$data.myvar);"> 
    … 
</span>​
```

{% hint style="info" %}
Перечень зарезервированных символов: «;», «~», «:», «\|», «.», «$», «+», «?», «\», «{», «}», «\[», «\]», «\(», «\)».
{% endhint %}

