# resource

Устанавливает значение для переменной из указанного источника или включает и выполняет указанный файл в зависимости от установленных параметров.

Условно источники подразделяются на два типа:

1. Внешние — доступ к источнику оскщствяется по HTTP протоколу
2. Локальные источники — источники расположенные на текущем сервере

## **Синтаксис**

```text
resource($address [, $params ~set $var ~import $var ~cache $integer]);
```

`$address` — переменная или строка содержащая адрес или путь до источника

`$params` — массив значений который будет передан в источник для последующей обработки \(необязательное значение\). Если массив параметров применен для внешнего источника, то значения массива будут переданы посредствам POST запроса. Для внутренних источников переданные параметры доступны через переменную $simParams.

`~set` — если параметр установлен, то полученная в результате запроса строка будет сохранена в переменную $var \(необязательный\)

`~import` — если параметр установлен, то все объявленные переменные источника будут сохранены в виде массива в переменную $var \(необязательный\)

`~cache` — если параметр установлен, то полученный результат запроса будет закеширован на указанное количество секунд \(необязательный\)

Параметры `~set` и `~import`, являются взаимоисключающими. Может быть использован только один из этих параметров в рамках одного оператора.

Если параметры `~set` и `~import` не указаны, то поведения оператора будет сравнимо с функцией php — `include()`. Полученное значение будет добавлено внутрь текущего элемента DOM.

```markup
<p data-sim="resource('/home/public_html/mytemplate.html' ~cache 3600);">
     ...
</p>
```

## Примеры использования

### **Работа с внешними источниками**

Для примера будем использовать googleapis.com. Отправим запрос на получение данных и сохраним ответ в атрибут «data-params» текущего элемента:

Шаблон:

```markup
<p data-sim="
        resource(
            'https://www.googleapis.com/fitness/v1/users/me/dataSources' 
            ~set $response
        );
        attributes('data-params', $response);">
        …
</p>
​
```

Ответ от googleapis.com:

```javascript
{
     "error": {
          "errors": [
               {
                    "domain": "global",
                    "reason": "required",
                    "message": "Login Required",
                    "locationType": "header",
                    "location": "Authorization"
               }
          ],
          "code": 401,
          "message": "Login Required"
     }
}
```

Результат выполнения:

```markup
<p data-params='{"error": {"errors": [{"domain": "global","reason": "required","message": "Login Required","locationType": "header","location": "Authorization"}],"code": 401,"message": "Login Required"}}'> 
   … 
</p>
```

Ответ, будет сохранен в переменную `$response` как строка. При использовании параметра `~set`, ответ источника не обязательно должен содержать JSON, это может быть любое строковое значение \(например HTML\).

Если вы знаете, что внешний источник возвращает JSON и хотите получить доступ к его отдельным значениям — необходимо использовать параметр `~import`. В этом случае, шаблонизатор в ответе от внешнего источника ожидает JSON, который будет преобразован в многомерный массив и сохранен в переменную `$response`.

Шаблон:

```markup
<p data-sim="
      resource(
          'https://www.googleapis.com/fitness/v1/users/me/dataSources' 
          ~import $response
      );
      content($response.error.message);">
      …
</p>​
```

Результат выполнения:

```markup
<p>Login Required</p>
```

### **Работа с локальными источниками**

Вы можете обратиться к любому php скрипту на локальном сервере для использования его результатов выполнения в шаблоне. Так же как и с внешними источниками, есть возможность получения результата в виде строкового значения \(с помощью параметра `~set`\) или в виде массива данных \(с помощью параметра `~import`\).

Пример php скрипта на локальном сервере:

```php
<?
     $a = 1;
     $b = 2;
     $c = $a+$b;
     echo $c;
?>
```

Подключения локального источника с параметром `~set`:

Шаблон:

```markup
<p data-sim="
      resource('/home/public_html/myscript.php' ~set $response);
      content($response);">
      …    
</p>
```

Результат выполнения:

```markup
<p>3</p>
```

Подключения локального источника с параметром `~import`:

Шаблон:

```markup
<p data-sim="
   resource('/home/public_html/myscript.php' ~import $response);
   content('Sum'+$response.a+' and '+$response.b+' = '+$response.c);">
   …    
</p>
```

Результат выполнения:

```markup
<p>Sum 1 and 2 = 3</p>​
```

Подключаем локальный источник и передаем в него дополнительные параметры:

Шаблон:

```markup
<p data-sim="
   resource('/home/public_html/template.html', ['a'=>1,'b'=>2] ~set $response);
   content($response);">
   …    
</p>​
```

Код подключаемого файла «template.html»:

```markup
<span>
     <?=$simParams['a']+$simParams['b'];?>
</span>
```

Результат выполнения:

```markup
<p>
   <span>3</span>
</p>
```

